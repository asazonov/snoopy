<!DOCTYPE html>
<html lang="en"><head>
        <meta http-equiv="content-type" content="text/html; charset=UTF-8">
        <meta charset="utf-8">
        <meta http-equiv="X-UA-Compatible" content="IE=edge">
        <meta name="viewport" content="width=device-width, initial-scale=1">
        <meta name="description" content="">
        <meta name="author" content="">
        <link rel="icon" href="http://getbootstrap.com/favicon.ico">

        <title>Starter Template for Bootstrap</title>

        <!-- Bootstrap core CSS -->
        <link href="css/bootstrap.min.css" rel="stylesheet">
        <!-- Custom styles for this template -->
        <script language="javascript" src="dalliance/dalliance-all.js"></script>
        <script language="javascript" src="FileSaver.js/FileSaver.min.js"></script>
        <script language="javascript" src="js/loadedfiletypes.js"></script>
        <script language="javascript" src="js/variants.js"></script>
        <link href="css/style.css" rel="stylesheet">

        <!-- Just for debugging purposes. Don't actually copy these 2 lines! -->
        <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->
        <script src="Starter_files/ie-emulation-modes-warning.js"></script>

        <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
        <!--[if lt IE 9]>
            <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
            <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
            <![endif]-->
    </head>

    <body>

        <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
            <div class="navbar-header">
                <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target=".navbar-collapse">
                    <span class="sr-only">Toggle navigation</span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </button>
                <a class="navbar-brand navbar-center" href="#">SNooP</a>
            </div>
            <div class="collapse navbar-collapse navbar-right">
                <ul class="nav navbar-nav">
                    <li><a href="#" data-toggle="modal" data-target="#modalHelp">Help</a></li>
                    <li><a href="#" data-toggle="modal" data-target="#modalSettings">Settings</a></li>
                    <li><a href="#about">About</a></li>
                    <li><a href="https://github.com/wtsi-medical-genomics/snoop/" target="_blank">GitHub</a></li>
                </ul>
            </div><!--/.nav-collapse -->
        </div>
        <!-- Fixed navbar -->
        <div class="navbar navbar-default navbar-fixed-top snoop-toolbar" id="controlCenter" role="navigation">
            <div class="containerfluid">
                <div class="row">
                    <div class="col-md-3 col-left">
                        Candidate Variant <div id="variantSelectListHolder"></div>
                    </div>
                    <div class="col-md-6 col-center">    
                        <button type="button" class="btn btn-default" id="goBack"><span class="glyphicon glyphicon-chevron-left"></span> Previous</button>
                        <div class="btn-group go-right">
                            <button type="button" class="btn btn-default" id="qcNotVariant">Not a Variant <span class="glyphicon glyphicon-chevron-right"></span></button>
                            <button type="button" class="btn btn-default" id="qcPotentialVariant">Uncertain <span class="glyphicon glyphicon-chevron-right"></span></button>
                            <button type="button" class="btn btn-default" id="qcCertainVariant">Variant <span class="glyphicon glyphicon-chevron-right"></span></button>
                        </div>
                    </div>
                    <div class="col-md-3 col-right">
                        <div class="btn-group">
                            <button type="button" class="btn btn-default" id="reload"><span class="glyphicon glyphicon-repeat"></span></button>
                            <!-- <button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-plus"></span></button> -->
                            <button type="button" class="btn btn-default" id="prepareDownloadQCreport"><span class="glyphicon glyphicon-floppy-save"></span></button>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="progress progress-bar-fixed" id="progressBar">
            <div class="progress-bar" id="variantProgress" role="progressbar" aria-valuenow="0" aria-valuemin="0" aria-valuemax="100" style="width: 0%;">
            </div>
        </div>

        <div class="container">
            <div class="row" id="fileLoader">
                <div class="col-md-3"></div>
                <div class="col-md-6">

                    <div class="panel panel-default" id="stepOne">
                        <div class="panel-body">
                            <h4 class="first">Welcome to SNooP</h4>
                            <p class="justify">With this tool you can review potential variant sites in short reads. The first step is to load your BAM and BAI files (x.bam will expect x.bam.bai) along with a text file containing the variant locations of interest. Note that multiple files can be selected at once.</p>
                            <!--<h4 class="notFirst">BAM/BAI files</h4>
                                <p>The BAM files are expected to be indexed and to be named according to the convention that if reads.bam is the BAM file then reads.bam.bai is the index file.</p>
                                <h4 class="notFirst">Variant text files</h4>
                                <p>Text files with the variants of interest expects one variant location per line with the locations having the following formats:<br><br>
                                chr:position<br>
                                chr-position<br>
                                chr position<br>
                                chr,position<br>
                                </ul> 
                                </p>
                            -->
                            <br>
                        </div>
                    </div>
                    <div class="panel panel-default step-two" id="loadedFilesPanel">
                        <div class="panel-heading">Loaded Files</div>
                        <table class="table" id="loadedFilesTable">
                        </table>
                    </div>
                    <div class="btn-group">
                        <div class="file-input btn btn-primary btn-file">
                            <span class="glyphicon glyphicon-upload"></span> <span id="loadFilesText">Load Files</span><input type="file" multiple id="fileLoaded">
                        </div>
                    </div>


                    <div class="btn-group">
                        <div class="btn btn-success" id="loadDalliance">
                            <span class="glyphicon glyphicon-search"></span> Start Qaulity Control 
                        </div>
                    </div>

                </div>
                <div class="col-md-3"></div>
            </div>
        </div><!-- /.container -->

        <div id="my-dalliance-holder">
            <div id="svgHolder">Dalliance genome browser goes here.  Unless you have an ancient web browser or something.</div>
        </div>

        <!-- Download QC Report Modal -->
        <div class="modal fade" id="modalDownloadQCreport" tabindex="-1" role="dialog" aria-labelledby="myModalDownloadQCreport" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalDownloadQCreport">Download QC Report</h4>
                    </div>
                    <div class="modal-body">
                        You have reviewed all of the 43 variant locations. 
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                        <button type="button" class="btn btn-primary" id="downloadQCreport">Download Report</button>
                    </div>
                </div>
            </div>
        </div>


        <!-- Help Modal -->
        <div class="modal fade" id="modalHelp" tabindex="-1" role="dialog" aria-labelledby="myModalHelp" aria-hidden="true">
            <div class="modal-dialog modal-lg">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalHel">Help</h4>
                    </div>
                    <div class="modal-body">
                        <h4 class="page-header">
                            Load Your Files
                        </h4>
                        Load BAM files, BAI files and a text file (.txt) with variant locations, one per line. The format of each variant in the text file can be any of the following
                        <ul class="list-unstyled">
                            <li>chr:loc</li>
                            <li>chr-loc</li>
                            <li>chr,loc</li>
                            <li>chr loc</li>
                        </ul>
                        You can repeatedly press Load More Files, that is, you don't have to select all of your files from a single open file dialog.  Once you have loaded all of your files, click 
                        <button type="button" class="btn btn-success btn-sm">
                            <span class="glyphicon glyphicon-search"></span> Start Qaulity Control 
                        </button>
                        <h4 class="page-header">
                            Quality Control 
                        </h4>
                        At this point you will see the Dalliance genomve viewer with your BAM files loaded, with the labels being the filenames. By default, differenes between the read and the reference are shown while matches are colored: plus strand is salmon; negative strand is pastel blue.  The first variant from your text file will located be in the center and highlighted. Make a decision about this variant and advance to the next by clicking one of 
                        <button type="button" class="btn btn-default btn-sm" >Not a Variant <span class="glyphicon glyphicon-chevron-right"></span></button>
                        <button type="button" class="btn btn-default btn-sm" >Uncertain <span class="glyphicon glyphicon-chevron-right"></span></button>
                        <button type="button" class="btn btn-default btn-sm" >Variant <span class="glyphicon glyphicon-chevron-right"></span></button>
                        To go back you can either click 
                        <button type="button" class="btn btn-default btn-sm" ><span class="glyphicon glyphicon-chevron-left"></span> Previous</button>
                        or select from the drop down list any variant site from your text file. The drop down list also displays your previous QC decision with the symbols listed in the table below.
                        <table>
                            <thead>
                                <tr>
                                    <th>Symbol</th>
                                    <th>QC Decision</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>&#x2717;</td><td>Not a Variant</td></tr>
                                <tr><td>?</td><td>Uncertain</td></tr>
                                <tr><td>&#x2713;</td><td>Variant</td></tr>
                            </tbody>
                        </table>
                        As you progress through your variants you will notice the status bar growing to reflect this.
                        <h4 class="page-header">
                            QC Review File
                        </h4>
                        When you have reached the final candidate variant, you will be asked if you would like to download the QC decisions. Note that you can download your progress before this point (i.e. you haven't reviewed all of the variants) by clicking on the download icon 
                        <button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-floppy-save"></span></button>. When prompred, provide a filename and this will be downloaded onto your machine as a text file. The results file has the following format
                        <div class="panel panel-default qc-file-format">
                            <div class="panel-body">
                                date and time of report creation<br>
                                BAM filename 1<br>
                                BAM filename 2<br>
                                .<br>
                                .<br>
                                .<br><br>


                                chr:variant location 1 : QC decision<br>
                                chr:variant location 2 : QC decision<br>
                                .<br>
                                .<br>
                                .
                            </div>
                        </div>
                        Where QC decision has the following encoding.
                        <table>
                            <thead>
                                <tr>
                                    <th>Code</th>
                                    <th>QC Decision</th>
                                </tr>
                            </thead>
                            <tbody>
                                <tr><td>-1</td><td>Not a Variant</td></tr>
                                <tr><td>0</td><td>Uncertain</td></tr>
                                <tr><td>1</td><td>Certain Variant</td></tr>
                                <tr><td>-99</td><td>No Decision Made</td></tr>  
                            </tbody>
                        </table>

                        <h4 class="page-header">
                            Restart 
                        </h4>
                        To restart at any time (which will lose all work unless you have downloaded your progress) click  
                        <button type="button" class="btn btn-default btn-sm"><span class="glyphicon glyphicon-repeat"></span></button>.
                    </div>
                </div>
            </div>
        </div>

        <!-- Settings Modal -->
        <div class="modal fade" id="modalSettings" tabindex="-1" role="dialog" aria-labelledby="myModalSettings" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <button type="button" class="close" data-dismiss="modal"><span aria-hidden="true">&times;</span><span class="sr-only">Close</span></button>
                        <h4 class="modal-title" id="myModalSettings">Settings</h4>
                    </div>
                    <div class="modal-body">
                        <table>
                            <tr>
                                <td rowspan="2">
                                    Default zoom level
                                </td>
                                <td>
                                    <input type="radio" name="defaultZoomLevel" id="defaultZoomLevelUnit">
                                </td>
                                <td>
                                    Unit base
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    <input type="radio" name="defaultZoomLevel" id="defaultZoomLevelCurrent">
                                </td>
                                <td>
                                    <div class="no-break"><input type="text"> bp</div> 
                                    <button type="button" class="btn btn-primary btn-sm">Capture current zoom level</button>
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Automatically zoom to default level when visiting new candidate variant
                                </td>
                                <td colspan="2">
                                    <input type="checkbox" id="autoZoom">
                                </td>
                            </tr>
                            <tr>
                                <td>
                                    Highlight mismatches & strands by default
                                </td>
                                <td colspan="2">
                                    <input type="checkbox" id="highlightDiff">
                                </td>
                            </tr>
                        </table>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-default" data-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.1/jquery.min.js"></script> 
        <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.2.0/js/bootstrap.min.js"></script>
        <script language="javascript" src="js/main.js"></script>

    </body>
</html>

